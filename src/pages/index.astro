---
import { getCollection } from "astro:content";

import AuthorCard from "@/components/Top/AuthorCard";
import BlogSelector from "@/components/Top/BlogSelector";
import MainVisual from "@/components/Top/MainVisual.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import TopLayout from "@/layouts/TopLayout.astro";

// 下書きを除外
const allPosts = await getCollection("blog", ({ data }) => {
  return data.draft !== true;
});

const recentPosts = allPosts
  .sort(
    (a, b) =>
      new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf(),
  )
  .slice(0, 3);
---

<BaseLayout>
  <TopLayout>
    <MainVisual />
    <div
      class="container mx-auto px-4 py-8 md:py-4 flex flex-col gap-8 md:gap-6"
    >
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-6 items-start">
        <div class="w-full flex items-center justify-center">
          <AuthorCard client:load />
        </div>
        <div class="w-full flex items-center justify-center">
          <BlogSelector client:load posts={recentPosts} />
        </div>
      </div>
    </div>
  </TopLayout>
</BaseLayout>
